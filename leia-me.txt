# ğŸ“‘ API Extrato INSS

API em **Node.js + OpenAI GPT** para processar **extratos de emprÃ©stimos consignados** do INSS a partir de PDFs.

---

## ğŸš€ Funcionalidades
- Upload de **PDFs de extratos do INSS**.
- Leitura de texto com **pdf-parse**.
- ExtraÃ§Ã£o de contratos ativos e dados do benefÃ­cio via **GPT**.
- CÃ¡lculo de **saldo devedor, troco, taxa de juros**.
- Armazenamento em JSON (cache).
- Endpoints REST para consulta.

---

## âš™ï¸ Tecnologias
- [Node.js](https://nodejs.org/) v22+
- [Express](https://expressjs.com/)
- [Multer](https://github.com/expressjs/multer) (upload)
- [pdf-parse-fixed](https://www.npmjs.com/package/pdf-parse-fixed)
- [OpenAI SDK](https://www.npmjs.com/package/openai)
- [Git/GitHub](https://github.com/)
- [Render](https://render.com/) (deploy)

---

## ğŸ“‚ Estrutura
.
â”œâ”€â”€ server.js # API principal (rotas express)
â”œâ”€â”€ extrair_pdf.js # FunÃ§Ãµes para ler PDF, chamar GPT e salvar JSON
â”œâ”€â”€ calculo.js # Regras de cÃ¡lculo (saldo devedor, troco, taxa)
â”œâ”€â”€ beneficios.js # Mapeamento de benefÃ­cios
â”œâ”€â”€ extratos/ # PDFs recebidos
â”œâ”€â”€ jsonDir/ # JSONs processados
â”œâ”€â”€ coeficientes_96.json # Tabela usada nos cÃ¡lculos
â””â”€â”€ package.json # DependÃªncias

yaml
Copiar cÃ³digo

---

## ğŸ”Œ Endpoints

### ExtraÃ§Ã£o
- `POST /extrair` â†’ baixa PDF da Lunas e processa
- `POST /extrair/upload` â†’ upload local de PDF
- `POST /extrair_paginas` â†’ processa pÃ¡gina a pÃ¡gina
- `POST /extrair/upload_paginas` â†’ upload com processamento por pÃ¡ginas

### Consulta
- `GET /extrair/:fileId` â†’ busca JSON jÃ¡ processado
- `GET /extrato/:fileId/raw` â†’ retorna JSON cru
- `GET /calcular/:fileId` â†’ cÃ¡lculo de troco

---

## ğŸ“¦ InstalaÃ§Ã£o

```bash
# clonar repositÃ³rio
git clone https://github.com/seu-usuario/api-extrato.git
cd api-extrato

# instalar dependÃªncias
npm install

# rodar local
npm start
ğŸ”‘ VariÃ¡veis de Ambiente
Crie um arquivo .env na raiz do projeto com:

ini
Copiar cÃ³digo
OPENAI_API_KEY=chave-da-openai
LUNAS_API_KEY=chave-da-lunas
LUNAS_QUEUE_ID=25
PORT=3000
ğŸŒ Deploy no Render
Crie um novo Web Service.

Conecte este repositÃ³rio.

Configure:

Start Command: npm start

Port: Render detecta via PORT.

Adicione as variÃ¡veis de ambiente acima no painel do Render.

Deploy automÃ¡tico a cada git push.

ğŸ› ï¸ Git / GitHub
bash
Copiar cÃ³digo
# adicionar arquivos
git add .

# criar commit
git commit -m "feat: primeira versÃ£o da API extrato"

# enviar para GitHub
git push origin main
âœ… Exemplo de Uso
Upload PDF
bash
Copiar cÃ³digo
curl -X POST http://localhost:3000/extrair/upload \
  -F "file=@extrato.pdf"
Resposta
json
Copiar cÃ³digo
{
  "cliente": "JOÃƒO DA SILVA",
  "beneficio": {
    "nb": "604321543-1",
    "nomeBeneficio": "APOSENTADORIA POR IDADE",
    "codigoBeneficio": 41
  },
  "margens": {
    "disponivel": "120,00",
    "extrapolada": "0,00",
    "rmc": "0,00",
    "rcc": "0,00"
  },
  "contratos": [
    {
      "contrato": "238906021033",
      "banco": "BANCO SANTANDER",
      "situacao": "ATIVO",
      "valor_parcela": "424,10",
      "prazo_total": 84,
      "parcelas_pagas": 37,
      "taxa_juros_mensal": "2,38",
      "taxa_juros_anual": "32,61"
    }
  ],
  "data_extrato": "05/2022"
}
